#!/usr/bin/env node

const chalk = require("chalk");
const config = require("./config");
const { run } = require("./utils");
require("dotenv").config({ path: config.envPath });

const imageVersion = process.env.IMAGE_VERSION;
const configuratorImage = `oharastream/configurator:${imageVersion}`;
const images = [
  `oharastream/zookeeper:${imageVersion}`,
  `oharastream/broker:${imageVersion}`,
  `oharastream/connect-worker:${imageVersion}`,
  `oharastream/stream:${imageVersion}`,
  `oharastream/shabondi:${imageVersion}`,
];

console.log(chalk.blue(`ðŸ“ƒ Updating images`));
  
const runMaster = run();
const runSlave = run({ isMaster: false });

runMaster("docker system prune -a -f");
runSlave("docker system prune -a -f");
runMaster(`docker pull ${configuratorImage}`);

images.forEach((image) => runSlave(`docker pull ${image}`));
